<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
		<link rel="stylesheet" href="../css_xsr/bootstrap.min.css" />
		<script type="text/javascript" src="../js_xsr/jquery-3.3.1.js"></script>
		<script type="text/javascript" src="../js_xsr/bootstrap.min.js"></script>
		<script type="text/javascript" src="../js_xsr/bootstrap-paginator.js"></script>
		<script type="text/javascript" src="../../../lsx_html/js/alert.js"></script>
		<link rel="stylesheet" href="../../../lsx_html/css/alert.css" />
			<style>
				td{
					text-align: center;
					width: 300px;
				}
				#tdt1{
					text-align: left;
				}
				#tdt2{
					text-align: right;
				}
			</style>
	<body>
		<div class='container'>
					<div style='top: 5px;position: absolute;border-radius: 150px'>
						<a href='javascript::' data-toggle="modal" data-target="#upload_xsr">
							<img id='tou_src1' src="../img_xsr/logo.png" style='width: 150px;height: 150px;border-radius: 150px'  />
						</a>
					</div>
					<div  style='top: 70px;position: absolute;left: 250px;'>
						昵称：<a id='nicheng' style="color: blue;" data-toggle="tooltip" title="双击修改昵称" ondblclick="xiuni()">昵称</a>
						 <input  class="form-control" placeholder="昵称" id="email" style="display: none;top: -30px;position: relative;left: 40px;">
						 <button id='buttonxiuni' onclick="xiunicheng()" class="btn btn-primary" style="display: none;top: -68px;position: relative;left: 280px;" >修改</button>
					</div>
				</div>
				<!--具体信息 table-->
				<div class='container' style='width: 100%;height: 400px;top: 160px;position: relative;'>
					    <table>
					    	<tr>
					    		<td id='tdt1'>
					    			实名认证<br>
					    			<font size='3' color='gray' >账户更安全出借更放心</font>
					    		</td>
					    		<td ><font id='renzheng' color='gray'>认证</font></td>
					    		<td id='tdt2'><font id='renzhengqueding'><a href='#'>立即认证</a></font></td>				    		
					    	</tr>
					    	<tr>
					    		<td colspan='3'><hr /></td>
					    	</tr>
					    	
					    	<tr>
					    		<td id='tdt1'>
					    			绑定手机<br>
					    			<font size='3' color='gray' >账户更安全出借更放心</font>
					    		</td>
					    		<td ><font id='phone' color='gray'>手机号码</font></td>
					    		<td id='tdt2'><font id='bdsj' color="gray"></font></td>				    		
					    	</tr>
					    	<tr>
					    		<td colspan='3'><hr /></td>
					    	</tr>
					    	
					    	<tr>
					    		<td id='tdt1'>
					    			绑定邮箱<br>
					    			<font size='3' color='gray' >及时获取账户资金变动通知和出借讯息</font>
					    		</td>
					    		<td ><font id='youxiang' color='gray'>未绑定</font></td>
					    		<td id='tdt2'><font id='bangyou' ><a href='../../xsr_bangyou.html' >立即绑定</a></font></td>				    		
					    	</tr>
					    	<tr>
					    		<td colspan='3'><hr /></td>
					    	</tr>
					    	
					    	<tr>
					    		<td id='tdt1'>
					    			登录密码<br>
					    			<font size='3' color='gray' >账户密码登录时需要填写</font>
					    		</td>
					    		<td ><font id='logintime' color='gray'>上次登录时间</font></td>
					    		<td id='tdt2'><a href='../../xsr_xiumi.html'>修改</a></td>				    		
					    	</tr>
					    	<tr>
					    		<td colspan='3'><hr /></td>
					    	</tr>
					    	
					    	<tr>
					    		<td id='tdt1'>
					    			信用评级<br>
					    			<font size='3' color='gray' >对您的信用进行评分</font>
					    		</td>
					    		<td ><font id='fenshu' color='gray'>400分</font></td>
					    		<td id='tdt2'><a href='javascript:shuapinfen()'>刷新评分</a></td>				    		
					    	</tr>
					    </table>
				</div>
				
				<!--模态-->
			<div class="modal fade" id="upload_xsr">
			    <div class="modal-dialog">
			      <div class="modal-content">
			      
			      <div align="center" >
			        <div class="control-group">
                        <label class="col-md-3 control-label span3"></label>
                        <div class="col-md-9" >
                            <img id='img_tou' border="1" style="width:150px;height:150px"><br>
                        </div>
                    </div>

                    <div class="control-group">

                        <label for="requirement" class="col-md-3 control-label span3">新头像预览</label>
                        <div class="col-md-9">
                            <div class="input-group">
                                <input id="photoCover" class="form-control" readonly type="text">
                                <label class="input-group-btn">
                                    <input id="file" type="file" name="file" style="left: -9999px; position: absolute;width: 100px">
                                    <span class="btn btn-default">点击选择图片</span>
                                </label>
                            </div>
                        </div>
                    </div>    
                    <input type="button" class="btn btn-info" onclick="saveUser2()" data-dismiss="modal" value="上传" style="width: 68%;">    <br><br>          	
				</div>	
				 				          	   
			      </div>
			    </div>
			  </div>
	</body>
	<script>
	$(document).ready(function(){
	    $('[data-toggle="tooltip"]').tooltip();   
	});
	function xiuni(){buttonxiuni
		$("#email").val($("#nicheng").html());
		$("#email").css("display","");
		$("#buttonxiuni").css("display","");
	}
	 //html5实现图片预览功能
    $(function () {
        $("#file").change(function (e) {
            var file = e.target.files[0] || e.dataTransfer.files[0];
            $('#photoCover').val(document.getElementById("file").files[0].name);
            if (file) {
                var reader = new FileReader();
                reader.onload = function () {
                    $("#img_tou").attr("src", this.result);
                }

                reader.readAsDataURL(file);
            }
        });
    })
	 
	 //异步上传图片
	 function saveUser2() {
            var file = document.getElementById("file").files[0]; 
            var formData = new FormData();
            formData.append('file', file);
            $.ajax({
                url: "../../../upload_Xsr",
                type: "post",
                data: formData, 
                contentType: false,
                processData: false,
                mimeType: "multipart/form-data",
                success: function (da) {
                   if(da==1){   
                	   document.getElementById("tou_src1").src="../img_xsr/jiazai.gif";
                	   setTimeout(function(){ window.location.href='zhanghu.html'},2000);               	  
                   }else{
	                	   var xsr1 = jqueryAlert({
	       					'content' : '头像修改失败',
	       					'width' :'350px',
	       					'height' :'100px',
	       					'modal' : true,
	       					'buttons' : {
	       						'确定' : function() {
	       							xsr1.close();
	       						}
	       					}
	       				})
                   }
                },
                error: function (data) {
                    console.log(data);
                }
               
            });
        }
	 //修改昵称
	 function xiunicheng(){
		 if($("#email").val()==$("#nicheng").html()){
			 
			 var xsr1 = jqueryAlert({
					'content' : '不能与修改之前的昵称一样',
					'width' :'350px',
					'height' :'100px',
					'modal' : true,
					'buttons' : {
						'确定' : function() {
							xsr1.close();
						}
					}
				})
				
			 return;
		 }
		 
		 $.ajax({
				url:"../../../xiunicheg_xsr",
				data:{
					nickname:$("#email").val()
				},
				dataType : "text",
				success:function(da){	
					window.location.href='zhanghu.html'
				}
			}) 
		 
	 }
	 
		$.ajax({
			url:"../../../zhanghu_xsr",
			data:{
				
			},
			dataType : "json",
			success:function(da){
				window.parent.dingnich(da.userinfo_xsr.nickname);
				$("#nicheng").html(da.userinfo_xsr.nickname);
				document.getElementById("tou_src1").src="../../../"+da.tou_src;
				if(da.userinfo_xsr.idnumber!=null){
						var name = da.userinfo_xsr.username;
						var le = name.length;
						if(le==2){
							name=name.substring(0,1)+"*";
						}else{
							name=name.substring(0,1)+"**";
						}
						$("#renzheng").html(name);
						$("#renzhengqueding").html("已认证");
						$("#renzhengqueding").css("color","gray");
				}else{
						$("#renzheng").html("未认证");
						$("#renzhengqueding").html("<a href='../../xsr_renzheng.html' target='_self' >立即认证</a>");						
				}
				var phone = da.userinfo_xsr.phone;
				phone = phone.substring(0,3)+"****"+phone.substring(7);
				$("#phone").html(phone);
				$("#bdsj").html("已绑定");
				$("#logintime").html("上次登录时间:"+da.logintime_xsr);
				$("#fenshu").html(da.customer_xsr.creditrate);
				
				var youxiang = da.customer_xsr.email;  
				if(youxiang!=null){
					$("#youxiang").html(youxiang);
					$("#bangyou").html("已绑定")
					$("#bangyou").css("color","gray");
				}else{
					$("#youxiang").html("未绑定");
					$("#bangyou").html("<a href='../../xsr_bangyou.html'>立即绑定</a>");
				}
				
			}
		});
		function shuapinfen(){
			 $.ajax({
					url:"../../../shuaping_xsr",
					data:{
						
					},
					dataType : "text",
					success:function(da){	
						$("#fenshu").html(da);
					}
				}) 
		}
	</script>
</html>
